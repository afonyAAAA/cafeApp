

DROP TABLE IF EXISTS "public".Role;



-- ************************* SqlDBM: PostgreSQL *************************
-- *********** Generated by SqlDBM: Cafe by nilo8370@gmail.com **********


DROP TABLE IF EXISTS "public".Document;



-- ************************* SqlDBM: PostgreSQL *************************
-- *********** Generated by SqlDBM: Cafe by nilo8370@gmail.com **********


DROP TABLE IF EXISTS "public"."User";


CREATE SCHEMA IF NOT EXISTS "public";


-- ************************************** "public"."User"

CREATE TABLE IF NOT EXISTS "public"."User"
(
 user_id     serial NOT NULL,
 login       varchar(50) NOT NULL,
 password    varchar(50) NOT NULL,
 firstName   varchar(100) NOT NULL,
 secondName  varchar(100) NOT NULL,
 surname     varchar(100) NOT NULL,
 document_id int NOT NULL,
 role_id     int NOT NULL,
 CONSTRAINT pk_user PRIMARY KEY ( user_id ),
 CONSTRAINT FK_1 FOREIGN KEY ( document_id ) REFERENCES "public".Document ( document_id ),
 CONSTRAINT FK_2 FOREIGN KEY ( role_id ) REFERENCES "public".Role ( role_id )
);





CREATE SCHEMA IF NOT EXISTS "public";


-- ************************************** "public".Document

CREATE TABLE IF NOT EXISTS "public".Document
(
 document_id  serial NOT NULL,
 contractLink text NOT NULL,
 photoLink    text NOT NULL,
 CONSTRAINT pk_document PRIMARY KEY ( document_id )
);


CREATE SCHEMA IF NOT EXISTS "public";


-- ************************************** "public".Role

CREATE TABLE IF NOT EXISTS "public".Role
(
 role_id serial NOT NULL,
 name    varchar(50) NOT NULL,
 CONSTRAINT pk_role PRIMARY KEY ( role_id )
);

CREATE TABLE IF NOT EXISTS UserWorkShift
(
 UserWorkShift_id serial NOT NULL,
 workShift_id     int NOT NULL,
 user_id          int NOT NULL,
 CONSTRAINT pk_userWorkShift PRIMARY KEY ( UserWorkShift_id ),
 CONSTRAINT fk_user FOREIGN KEY ( user_id ) REFERENCES "public"."User" ( user_id ),
 CONSTRAINT fk_workShift FOREIGN KEY ( workShift_id ) REFERENCES WorkShift ( workShift_id )
);

CREATE TABLE IF NOT EXISTS WorkShift
(
 workShift_id serial NOT NULL,
 timeStart    time NOT NULL,
 timeEnd      time NOT NULL,
 "date"         date NOT NULL,
 CONSTRAINT pk_workShift PRIMARY KEY ( workShift_id )
);

create schema as WorkShiftUsersS

create or replace view WorkShiftUsers as
select w.date, concat(w.timestart, ' ', w.timeend) as Time, concat(u.FirstName, ' ', u.SecondName, ' ', u.surname) as FullName, r.name
FROM userworkshift uw 
join "User" u ON u.user_Id = uw.user_id
join "role" r on r.role_id = u.role_id
join workshift w on w.workshift_id = uw.workshift_Id 

select * from WorkShiftUsers

